name: âš¡ Performance Benchmarks

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  benchmark:
    name: âš¡ Run Benchmarks
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
      - uses: Swatinem/rust-cache@v2
        with:
          workspaces: crates

      - name: ðŸ—ï¸ Build Release
        run: cargo build --release -p neex-cli
        working-directory: crates

      - name: âš¡ Run Benchmarks
        run: |
          echo "## âš¡ Performance Benchmarks" > benchmark-results.md
          echo "| Test | Result |" >> benchmark-results.md
          echo "|------|--------|" >> benchmark-results.md
          echo "| Build | âœ… Success |" >> benchmark-results.md
          echo "| Binary Size | $(du -h target/release/neex | cut -f1) |" >> benchmark-results.md
        working-directory: crates

      - name: ðŸ“ˆ Store Results
        if: github.ref == 'refs/heads/main'
        run: |
          git config --local user.email "amirrezafoshati@gmail.com"
          git config --local user.name "foshati"
          mkdir -p benchmarks
          cp crates/benchmark-results.md benchmarks/$(date +%Y-%m-%d).md
          git add benchmarks/ || true
          git commit -m "ðŸ“ˆ Add benchmark results for $(date +%Y-%m-%d)" || true
          git push || true